include $(MAKEDEFAULTDIR)/MakeStdLibRules.$(TARGET)

%.spb : 
	$(MAKE) -C $* TARGET=$(TARGET) MAKEMODE=$(MAKEMODE) MAKEPATH=$(MAKEPATH)

MAKEMODE:=INFO
MAKEPATH:=VERTICAL

.PHONY: clean
clean:  
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=CLEAN

.PHONY: cleanLT
cleanLT:   
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=CLEANLT MAKEPATH=HORIZONTAL

.PHONY: test
test: 	
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=TEST

.PHONY: localTest
localTest: 	
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=LOCALTEST MAKEPATH=HORIZONTAL

.PHONY: all
all: 	
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=ALL

.PHONY: build
build: 	
	$(MAKE)  TARGET=$(TARGET) MAKEMODE=BUILD

##do_cleandir:
# defined in the platform MakeStdLibRules.$(TARGET)
        
.PHONY: do_showInfo
do_showInfo: 	
	@echo choose among 
	@echo 1\) make build     to build libraries
	@echo 2\) make clean     to remove any produced file
	@echo 3\) make test      to build test programs after all the libraries
	@echo 4\) make localTest to build test programs level by level
	@echo 5\) make cleanLT   to remove any produced file in the local test build
	@echo 6\) make all       to build libraries and test programs
	@echo choose targer by adding -D TARGET  {msc x86-linux ...}
	@echo current target is $(TARGET)
    

ifeq (CLEANLT,$(MAKEMODE))
DEPENDS = do_cleandir $(SUBPROJLT) $(SUBPROJLT2)
endif

ifeq (CLEAN,$(MAKEMODE))
DEPENDS = do_cleandir $(SUBPROJ)
endif

ifeq (INFO,$(MAKEMODE))
DEPENDS = do_showInfo
endif

ifeq (BUILD,$(MAKEMODE))
DEPENDS = $(OBJS) $(SUBPROJ) $(BUILD_PRODUCT)
include depends.$(TARGET)
endif

ifeq (TEST,$(MAKEMODE))
DEPENDS = $(OBJS) $(SUBPROJT) $(BUILD_PRODUCT)
include depends.$(TARGET)
endif

ifeq (LOCALTEST,$(MAKEMODE))
DEPENDS = $(OBJS) $(SUBPROJLT) $(BUILD_PRODUCT) $(SUBPROJLT2)
include depends.$(TARGET)
endif

ifeq (ALL,$(MAKEMODE))
DEPENDS = $(OBJS)  $(SUBPROJLT) $(SUBPROJT) $(BUILD_PRODUCT)
include depends.$(TARGET)
endif
		
.PHONY: default
default:   $(DEPENDS)
	@echo MAKEMODE=$(MAKEMODE) MAKEPATH=$(MAKEPATH) 
	@echo VTEARS=$(VTEARS)
	@echo HTEARS=$(HTEARS)
	@echo SPBLT= $(SPBLT)
	@echo executed $(DEPENDS)
